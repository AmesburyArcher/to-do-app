(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{N:()=>x,s:()=>b});const t=()=>{document.querySelector(".current-date").textContent=n()};function n(){const e=new Date;let t=1==e.getMinutes().toString().length?"0"+e.getMinutes():e.getMinutes(),n=1==e.getHours().toString().length?"0"+e.getHours():e.getHours(),o=e.getHours()>=12?"pm":"am";return["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][e.getDay()]+" "+["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][e.getMonth()]+" "+e.getDate()+" "+e.getFullYear()+" "+n+":"+t+o}const o=document.querySelector("#to-do-list"),a=document.querySelector(".to-do-title"),s=document.querySelector(".task-count"),r=document.querySelector(".tasks"),c=document.querySelector("#task-template"),l=e=>{const t=e.tasks.filter((e=>!e.complete)).length,n=1===t?"task":"tasks";s.textContent=`${t} ${n} remaining`},i=()=>{const e=g.find((e=>e.id===v));null==e?o.style.display="none":(o.style.display="",a.textContent=e.name,l(e),h(r),e.tasks.forEach((e=>{const t=document.importNode(c.content,!0),n=t.querySelector("input");n.id=e.id,n.checked=e.complete,t.querySelector(".task-name").textContent=e.name;const o=t.querySelector(".task-desc");e.desc?o.textContent=` Description: ${e.desc}`:o.textContent="No Description.";const a=t.querySelector(".task-date");e.date?a.textContent=` Complete by: ${e.date}`:a.textContent="No Completion Date.",t.querySelector(".task-posted").textContent=`Posted on: ${e.posted}`,t.querySelector(".edit-task").innerHTML='<svg xmlns="http://www.w3.org/2000/svg" class="edit-task-icon" width="20" height="20" viewBox="0 0 24 24" stroke-width="1.5" stroke="#000000" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 20h4l10.5 -10.5a1.5 1.5 0 0 0 -4 -4l-10.5 10.5v4" /><line x1="13.5" y1="6.5" x2="17.5" y2="10.5" /></svg>',r.appendChild(t)})))},d=(e,t,n,o)=>({id:Date.now().toString(),name:e,desc:t,date:n,posted:o,complete:!1}),u="task.list",m="task.selectedFolder";let v=localStorage.getItem(m),g=JSON.parse(localStorage.getItem(u))||[];const y=()=>{k(),p()},k=()=>{localStorage.setItem(u,JSON.stringify(g)),localStorage.setItem(m,v)},p=()=>{const e=document.querySelector(".directory");h(e),g.forEach((t=>{const n=x("li",null,["directory-folder"],t.name);n.dataset.listId=t.id,t.id===v&&n.classList.add("directory-active"),e.appendChild(n);const o=x("span",null,["directory-folder-icons"],null);o.innerHTML='<button class="button-edit"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-edit" width="18" height="18" viewBox="0 0 24 24" stroke-width="1.5" stroke="#ffffff" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 20h4l10.5 -10.5a1.5 1.5 0 0 0 -4 -4l-10.5 10.5v4" /><line x1="13.5" y1="6.5" x2="17.5" y2="10.5" /></svg></button><button class="button-trash"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-trash" width="18" height="18" viewBox="0 0 24 24" stroke-width="1.5" stroke="#ffffff" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><line x1="4" y1="7" x2="20" y2="7" /><line x1="10" y1="11" x2="10" y2="17" /><line x1="14" y1="11" x2="14" y2="17" /><path d="M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12" /><path d="M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3" /></svg></button>',n.classList.contains("directory-active")&&n.appendChild(o)}))},h=e=>{for(;e.firstChild;)e.removeChild(e.firstChild)},S=e=>{const t=document.querySelector(".add-dir-btn-text");e.preventDefault();const n=t.value;if(null==n||""===n)return;const o=E(n);t.value=null,g.push(o),y()},f=e=>{"li"===e.target.tagName.toLowerCase()&&(v=e.target.dataset.listId,y(),i())},L=e=>{(e.target.classList.contains("icon-trash")||e.target.classList.contains("button-trash"))&&(e.target.parentElement.parentElement.parentElement.dataset.listId!==v&&e.target.parentElement.parentElement.dataset.listId!==v||(g=g.filter((e=>e.id!==v)),v=null,b()))},q=e=>{if((e.target.classList.contains("icon-edit")||e.target.classList.contains("button-edit"))&&(e.target.parentElement.parentElement.parentElement.dataset.listId===v||e.target.parentElement.parentElement.dataset.listId===v)){const e=document.querySelector(".directory-modal-container");e.classList.toggle("active");const t=document.querySelector("#directory-edit-form"),n=document.querySelector(".icon-tabler-square-x"),o=n=>{n.preventDefault();const a=document.querySelector("#text-dir"),s=a.value;null!=s&&""!==s&&(g.forEach((e=>{e.id===v&&(e.name=s)})),a.value=null,y(),i(),e.classList.remove("active"),t.removeEventListener("submit",o))},a=()=>{e.classList.remove("active"),t.removeEventListener("submit",o),n.removeEventListener("click",a)};n.addEventListener("click",a),t.addEventListener("submit",o)}},E=e=>({id:Date.now().toString(),name:e,tasks:[]});function x(e,t,n,o){const a=document.createElement(e);return t&&(a.id=t),n&&n.forEach((e=>a.classList.add(e))),o&&(a.textContent=o),a}const b=()=>{y(),i()};setInterval(t,1e3),(()=>{const e=document.querySelector(".light-dark-mode");e.addEventListener("click",(function(){t=localStorage.getItem("darkMode"),"enabled"!==t?(localStorage.setItem("darkMode","enabled"),document.body.classList.add("active"),e.classList.add("active")):(localStorage.setItem("darkMode",null),document.body.classList.remove("active"),e.classList.remove("active")),e.classList.contains("active")?n.textContent="Dark Mode":n.textContent="Light Mode"}));let t=localStorage.getItem("darkMode");const n=document.querySelector(".current-theme");"enabled"===t&&(localStorage.setItem("darkMode","enabled"),document.body.classList.add("active"),e.classList.add("active"),n.textContent="Dark Mode")})(),b(),(()=>{const e=document.querySelector("#add-dir-form"),t=document.querySelector(".directory");e.addEventListener("submit",S),t.addEventListener("click",f),t.addEventListener("click",L),t.addEventListener("click",q)})(),document.querySelector(".create-task-btn").addEventListener("click",(()=>{document.querySelector(".modal-container").classList.add("active")})),document.querySelector("#add-task").addEventListener("submit",(e=>{e.preventDefault();const t=document.querySelector(".modal-container"),o=document.querySelector("#task"),a=document.querySelector("#description"),s=document.querySelector("#date"),r=n(),c=o.value;if(null==c||""===c)return;const l=a.value,i=s.value,u=d(c,l,i,r);o.value=null,a.value=null,s.value=null,g.find((e=>e.id===v)).tasks.push(u),t.classList.remove("active"),b()})),r.addEventListener("click",(e=>{if("input"===e.target.tagName.toLowerCase()){const t=g.find((e=>e.id===v));t.tasks.find((t=>t.id===e.target.id)).complete=e.target.checked,k(),l(t)}})),r.addEventListener("click",(e=>{const t=g.find((e=>e.id===v)),n=e.target.parentNode.parentNode,o=Array.from(n.parentNode.children).indexOf(n),a=document.querySelector(".task-edit"),s=document.querySelector(".description-edit"),r=document.querySelector(".date-edit");let c=t.tasks[o];const l=document.querySelector(".modal-container-edit"),d=document.querySelector("#add-task-edit");if(e.target.classList.contains("edit-task-icon")||e.target.classList.contains("edit-task")){a.value=c.name,c.desc?s.value=c.desc:s.value="",c.date?r.value=c.date:r.value="",l.classList.add("active");const e=t=>{console.log(o),t.preventDefault(),c.name=a.value,c.desc=s.value,c.date=r.value,c="",console.log(c),l.classList.remove("active"),d.removeEventListener("submit",e),i(),k()},t=()=>{d.removeEventListener("submit",e),l.classList.remove("active"),n.removeEventListener("click",t)},n=document.querySelector(".close-task-modal-edit");n.addEventListener("click",t),d.addEventListener("submit",e)}})),document.querySelector(".delete-tasks").addEventListener("click",(()=>{const e=g.find((e=>e.id===v));e.tasks=e.tasks.filter((e=>!e.complete)),b()})),document.querySelector(".close-task-modal").addEventListener("click",(()=>{document.querySelector(".modal-container").classList.remove("active")})),t()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Z0MsR0FDM0MxRyxJQUNBaUMsS0FHRTRFLEVBQWdCLEtBQ2xCSixFQUFhL0Isb0JBQW9CLFNBQVVnQyxHQUMzQ0YsRUFBYzdELFVBQVU4QixPQUFPLFVBQy9CcUMsRUFBbUJwQyxvQkFBb0IsUUFBU21DLElBRzlDQyxFQUFxQjVJLFNBQVNDLGNBQWMsMEJBQ2xEMkksRUFBbUJsQyxpQkFBaUIsUUFBU2lDLEdBRTlDSixFQUFhN0IsaUJBQWlCLFNBQVU4QixPQXhHdkJ4SSxTQUFTQyxjQUFjLGlCQUMvQnlHLGlCQUFpQixTQVFMLEtBQ3hCLE1BQU0zRSxFQUFlQyxFQUFhQyxNQUFLQyxHQUFRQSxFQUFLQyxLQUFPQyxJQUMzREwsRUFBYU4sTUFBUU0sRUFBYU4sTUFBTUMsUUFBT0MsSUFBU0EsRUFBS0MsV0FDN0RpRSxPQVRrQjdGLFNBQVNDLGNBQWMscUJBQy9CeUcsaUJBQWlCLFNBeUhSLEtBQ0QxRyxTQUFTQyxjQUFjLG9CQUMvQndFLFVBQVU4QixPQUFPLGFFN0gzQnhHLEsiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly90by1kby1hcHAvd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vdG8tZG8tYXBwL3dlYnBhY2svcnVudGltZS9kZWZpbmUgcHJvcGVydHkgZ2V0dGVycyIsIndlYnBhY2s6Ly90by1kby1hcHAvd2VicGFjay9ydW50aW1lL2hhc093blByb3BlcnR5IHNob3J0aGFuZCIsIndlYnBhY2s6Ly90by1kby1hcHAvLi9zcmMvZGF0ZS5qcyIsIndlYnBhY2s6Ly90by1kby1hcHAvLi9zcmMvbGlzdC1jcmVhdG9yLmpzIiwid2VicGFjazovL3RvLWRvLWFwcC8uL3NyYy9kaXJlY3RvcnktY3JlYXRvci5qcyIsIndlYnBhY2s6Ly90by1kby1hcHAvLi9zcmMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vdG8tZG8tYXBwLy4vc3JjL3RvZ2dsZVRoZW1lLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIFRoZSByZXF1aXJlIHNjb3BlXG52YXIgX193ZWJwYWNrX3JlcXVpcmVfXyA9IHt9O1xuXG4iLCIvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9ucyBmb3IgaGFybW9ueSBleHBvcnRzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSAoZXhwb3J0cywgZGVmaW5pdGlvbikgPT4ge1xuXHRmb3IodmFyIGtleSBpbiBkZWZpbml0aW9uKSB7XG5cdFx0aWYoX193ZWJwYWNrX3JlcXVpcmVfXy5vKGRlZmluaXRpb24sIGtleSkgJiYgIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBrZXkpKSB7XG5cdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywga2V5LCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZGVmaW5pdGlvbltrZXldIH0pO1xuXHRcdH1cblx0fVxufTsiLCJfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSAob2JqLCBwcm9wKSA9PiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwgcHJvcCkpIiwiY29uc3QgZGlzcGxheURhdGUgPSAoKSA9PiB7XG4gICAgY29uc3QgZGF0ZURPTSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jdXJyZW50LWRhdGUnKTtcbiAgICBkYXRlRE9NLnRleHRDb250ZW50ID0gZm9ybWF0QU1QTSgpXG59XG5cblxuLy8gY3JlYXRlcyB0aGUgY3VycmVudCBkYXRlIGF0IHRpbWUgb2YgZXhlY3V0aW9uXG5mdW5jdGlvbiBmb3JtYXRBTVBNKCkge1xuICAgIGNvbnN0IGQgPSBuZXcgRGF0ZSgpXG4gICAgbGV0IG1pbnV0ZXMgPSBkLmdldE1pbnV0ZXMoKS50b1N0cmluZygpLmxlbmd0aCA9PSAxID8gJzAnK2QuZ2V0TWludXRlcygpIDogZC5nZXRNaW51dGVzKCk7XG4gICAgbGV0IGhvdXJzID0gZC5nZXRIb3VycygpLnRvU3RyaW5nKCkubGVuZ3RoID09IDEgPyAnMCcrZC5nZXRIb3VycygpIDogZC5nZXRIb3VycygpO1xuICAgIGxldCBhbXBtID0gZC5nZXRIb3VycygpID49IDEyID8gJ3BtJyA6ICdhbSc7XG4gICAgbGV0IG1vbnRocyA9IFsnSmFuJywnRmViJywnTWFyJywnQXByJywnTWF5JywnSnVuJywnSnVsJywnQXVnJywnU2VwJywnT2N0JywnTm92JywnRGVjJ107XG4gICAgbGV0IGRheXMgPSBbJ1N1bicsJ01vbicsJ1R1ZScsJ1dlZCcsJ1RodScsJ0ZyaScsJ1NhdCddO1xuICAgIHJldHVybiBkYXlzW2QuZ2V0RGF5KCldKycgJyttb250aHNbZC5nZXRNb250aCgpXSsnICcrZC5nZXREYXRlKCkrJyAnK2QuZ2V0RnVsbFllYXIoKSsnICcraG91cnMrJzonK21pbnV0ZXMrYW1wbTtcbiAgICB9XG5cbmV4cG9ydCB7IGRpc3BsYXlEYXRlLCBmb3JtYXRBTVBNIH0iLCJpbXBvcnQgeyBjcmVhdGVIVE1MRWxlbWVudCwgcmVuZGVyIH0gZnJvbSBcIi4vaW5kZXhcIjtcbmltcG9ydCB7IHJlbmRlckxpc3RzLCBjcmVhdGVEaXJMaXN0ZW5lciwgc2F2ZUFuZFJlbmRlckxpc3QsIGRpcmVjdG9yeUFyciwgc2VsZWN0ZWRGb2xkZXIsIGNsZWFyTGlzdCwgc2F2ZSB9IGZyb20gXCIuL2RpcmVjdG9yeS1jcmVhdG9yXCI7XG5pbXBvcnQgeyBmb3JtYXRBTVBNIH0gZnJvbSBcIi4vZGF0ZVwiO1xuXG5cbmNvbnN0IGZvbGRlckRpc3BsYXlDb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjdG8tZG8tbGlzdCcpO1xuY29uc3QgZm9sZGVyVGl0bGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcudG8tZG8tdGl0bGUnKTtcbmNvbnN0IHRhc2tDb3VudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy50YXNrLWNvdW50Jyk7XG5jb25zdCB0YXNrQ29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnRhc2tzJyk7XG5jb25zdCB0YXNrVGVtcGxhdGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjdGFzay10ZW1wbGF0ZScpO1xuXG4vLyBjcmVhdGVzIGxpc3RlbmVycyBmb3IgdGFza3NcbmNvbnN0IGxpc3RMaXN0ZW5lcnMgPSAoKSA9PiB7XG4gICAgY29uc3QgY3JlYXRlVGFza0J0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jcmVhdGUtdGFzay1idG4nKTtcbiAgICBjcmVhdGVUYXNrQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgY3JlYXRlVGFza01vZGFsKVxuXG4gICAgY29uc3Qgc3VibWl0VGFzayA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNhZGQtdGFzaycpO1xuICAgIHN1Ym1pdFRhc2suYWRkRXZlbnRMaXN0ZW5lcignc3VibWl0Jywgc3VibWl0Rm9ybSk7XG5cbiAgICAvL2NoZWNrIGlmIGNvbXBsZXRlXG4gICAgdGFza0NvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRhc2tDaGVjayk7XG5cbiAgICAvL2VkaXQgdGFza1xuICAgIHRhc2tDb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBlZGl0VGFza0RldGFpbHMpO1xuXG4gICAgY29uc3QgZGVsZXRlVGFza3MgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZGVsZXRlLXRhc2tzJyk7XG4gICAgZGVsZXRlVGFza3MuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBkZWxldGVTZWxlY3RlZFRhc2tzKVxuXG4gICAgY29uc3QgY2xvc2VUYXNrID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmNsb3NlLXRhc2stbW9kYWwnKTtcbiAgICBjbG9zZVRhc2suYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBjbG9zZVRhc2tNb2RhbCk7XG4gICAgXG59XG5cbi8vIGRlbGV0ZXMgc2VsZWN0ZWQgdGFza3NcbmNvbnN0IGRlbGV0ZVNlbGVjdGVkVGFza3MgPSAoKSA9PiB7XG4gICAgY29uc3Qgc2VsZWN0ZWRMaXN0ID0gZGlyZWN0b3J5QXJyLmZpbmQobGlzdCA9PiBsaXN0LmlkID09PSBzZWxlY3RlZEZvbGRlcik7XG4gICAgc2VsZWN0ZWRMaXN0LnRhc2tzID0gc2VsZWN0ZWRMaXN0LnRhc2tzLmZpbHRlcih0YXNrID0+ICF0YXNrLmNvbXBsZXRlKTtcbiAgICByZW5kZXIoKTtcbn1cblxuLy8gY2hlY2tzIGlmIHRhc2sgaXMgbWFya2VkIGNvbXBsZXRlXG5jb25zdCB0YXNrQ2hlY2sgPSAoZSkgPT4ge1xuICAgIGlmKGUudGFyZ2V0LnRhZ05hbWUudG9Mb3dlckNhc2UoKSA9PT0gJ2lucHV0Jykge1xuICAgICAgICBjb25zdCBzZWxlY3RlZExpc3QgPSBkaXJlY3RvcnlBcnIuZmluZChsaXN0ID0+IGxpc3QuaWQgPT09IHNlbGVjdGVkRm9sZGVyKTtcbiAgICAgICAgY29uc3Qgc2VsZWN0ZWRUYXNrID0gc2VsZWN0ZWRMaXN0LnRhc2tzLmZpbmQodGFzayA9PiB0YXNrLmlkID09PSBlLnRhcmdldC5pZCkgXG4gICAgICAgIHNlbGVjdGVkVGFzay5jb21wbGV0ZSA9IGUudGFyZ2V0LmNoZWNrZWQ7XG4gICAgICAgIHNhdmUoKTtcbiAgICAgICAgcmVuZGVyVGFza051bShzZWxlY3RlZExpc3QpO1xuICAgIH1cbn1cblxuLy8gcmVuZGVycyBhbmQgZGlzcGxheXMgdG8gRE9NIG51bWJlciBvZiB0YXNrcyByZW1haW5pbmcgdG8gY29tcGxldGVcbmNvbnN0IHJlbmRlclRhc2tOdW0gPSAoc2VsZWN0ZWRUYXNrTnVtKSA9PiB7XG4gICAgY29uc3QgaW5jb21wbGV0ZSA9IHNlbGVjdGVkVGFza051bS50YXNrcy5maWx0ZXIodGFzayA9PiAhdGFzay5jb21wbGV0ZSkubGVuZ3RoO1xuICAgIGNvbnN0IHRhc2tzU3RyaW5nID0gaW5jb21wbGV0ZSA9PT0gMSA/IFwidGFza1wiIDogXCJ0YXNrc1wiO1xuICAgIHRhc2tDb3VudC50ZXh0Q29udGVudCA9IGAke2luY29tcGxldGV9ICR7dGFza3NTdHJpbmd9IHJlbWFpbmluZ2A7XG59XG5cbi8vIGZ1bmN0aW9uIHVzZWQgdG8gY3JlYXRlIHRoZSB0YXNrIGVsZW1lbnQgZm9yIHRoZSBET01cbmNvbnN0IHJlbmRlclRhc2tMaXN0ID0gKHNlbGVjdGVkVGFza0xpc3QpID0+IHtcbiAgICBzZWxlY3RlZFRhc2tMaXN0LnRhc2tzLmZvckVhY2godGFzayA9PiB7XG4gICAgICAgIGNvbnN0IHRhc2tET00gPSBkb2N1bWVudC5pbXBvcnROb2RlKHRhc2tUZW1wbGF0ZS5jb250ZW50LCB0cnVlKVxuICAgICAgICBjb25zdCBjaGVja0JveCA9IHRhc2tET00ucXVlcnlTZWxlY3RvcignaW5wdXQnKTtcbiAgICAgICAgY2hlY2tCb3guaWQgPSB0YXNrLmlkO1xuICAgICAgICBjaGVja0JveC5jaGVja2VkID0gdGFzay5jb21wbGV0ZTtcbiAgICAgICAgY29uc3QgdGFza05hbWUgPSAgdGFza0RPTS5xdWVyeVNlbGVjdG9yKCcudGFzay1uYW1lJyk7XG4gICAgICAgIHRhc2tOYW1lLnRleHRDb250ZW50ID0gdGFzay5uYW1lO1xuXG4gICAgICAgIGNvbnN0IHRhc2tEZXNjID0gdGFza0RPTS5xdWVyeVNlbGVjdG9yKCcudGFzay1kZXNjJylcbiAgICAgICAgdGFzay5kZXNjID8gdGFza0Rlc2MudGV4dENvbnRlbnQgPSBgIERlc2NyaXB0aW9uOiAke3Rhc2suZGVzY31gIDogdGFza0Rlc2MudGV4dENvbnRlbnQgPSAnTm8gRGVzY3JpcHRpb24uJztcbiAgICAgICBcbiAgICAgICAgY29uc3QgdGFza0RhdGUgPSB0YXNrRE9NLnF1ZXJ5U2VsZWN0b3IoJy50YXNrLWRhdGUnKTtcbiAgICAgICAgdGFzay5kYXRlID8gdGFza0RhdGUudGV4dENvbnRlbnQgPSBgIENvbXBsZXRlIGJ5OiAke3Rhc2suZGF0ZX1gIDogdGFza0RhdGUudGV4dENvbnRlbnQgPSAnTm8gQ29tcGxldGlvbiBEYXRlLic7XG5cbiAgICAgICAgY29uc3QgdGFza1Bvc3RlZCA9IHRhc2tET00ucXVlcnlTZWxlY3RvcignLnRhc2stcG9zdGVkJyk7XG4gICAgICAgIHRhc2tQb3N0ZWQudGV4dENvbnRlbnQgPSBgUG9zdGVkIG9uOiAke3Rhc2sucG9zdGVkfWA7XG5cbiAgICAgICAgY29uc3QgZWRpdFRhc2sgPSB0YXNrRE9NLnF1ZXJ5U2VsZWN0b3IoJy5lZGl0LXRhc2snKTtcbiAgICAgICAgZWRpdFRhc2suaW5uZXJIVE1MID0gJzxzdmcgeG1sbnM9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiIGNsYXNzPVwiZWRpdC10YXNrLWljb25cIiB3aWR0aD1cIjIwXCIgaGVpZ2h0PVwiMjBcIiB2aWV3Qm94PVwiMCAwIDI0IDI0XCIgc3Ryb2tlLXdpZHRoPVwiMS41XCIgc3Ryb2tlPVwiIzAwMDAwMFwiIGZpbGw9XCJub25lXCIgc3Ryb2tlLWxpbmVjYXA9XCJyb3VuZFwiIHN0cm9rZS1saW5lam9pbj1cInJvdW5kXCI+PHBhdGggc3Ryb2tlPVwibm9uZVwiIGQ9XCJNMCAwaDI0djI0SDB6XCIgZmlsbD1cIm5vbmVcIi8+PHBhdGggZD1cIk00IDIwaDRsMTAuNSAtMTAuNWExLjUgMS41IDAgMCAwIC00IC00bC0xMC41IDEwLjV2NFwiIC8+PGxpbmUgeDE9XCIxMy41XCIgeTE9XCI2LjVcIiB4Mj1cIjE3LjVcIiB5Mj1cIjEwLjVcIiAvPjwvc3ZnPidcblxuICAgICAgICB0YXNrQ29udGFpbmVyLmFwcGVuZENoaWxkKHRhc2tET00pO1xuICAgIH0pXG4gICAgXG59XG5cbmNvbnN0IGVkaXRUYXNrRGV0YWlscyA9IChlKSA9PiB7XG5cbiAgICBjb25zdCBzZWxlY3RlZExpc3QgPSBkaXJlY3RvcnlBcnIuZmluZChsaXN0ID0+IGxpc3QuaWQgPT09IHNlbGVjdGVkRm9sZGVyKTsgXG4gICAgY29uc3Qgc2VsZWN0ZWRFbGVtZW50ID0gZS50YXJnZXQucGFyZW50Tm9kZS5wYXJlbnROb2RlO1xuICAgIGNvbnN0IHNlbGVjdGVkVGFzayA9IEFycmF5LmZyb20oc2VsZWN0ZWRFbGVtZW50LnBhcmVudE5vZGUuY2hpbGRyZW4pLmluZGV4T2Yoc2VsZWN0ZWRFbGVtZW50KVxuXG4gICAgY29uc3QgdGFza0lucHV0TmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy50YXNrLWVkaXQnKTtcbiAgICBjb25zdCB0YXNrSW5wdXREZXNjID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmRlc2NyaXB0aW9uLWVkaXQnKTtcbiAgICBjb25zdCB0YXNrSW5wdXREYXRlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmRhdGUtZWRpdCcpO1xuXG4gICAgbGV0IGl0ZW1zID0gc2VsZWN0ZWRMaXN0LnRhc2tzW3NlbGVjdGVkVGFza107XG4gICAgY29uc3QgdGFza0VkaXRNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbC1jb250YWluZXItZWRpdCcpO1xuICAgIGNvbnN0IHRhc2tFZGl0Rm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNhZGQtdGFzay1lZGl0Jyk7XG5cbiAgICBpZihlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2VkaXQtdGFzay1pY29uJykgfHwgZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdlZGl0LXRhc2snKSkge1xuICAgICAgIHRhc2tJbnB1dE5hbWUudmFsdWUgPSBpdGVtcy5uYW1lO1xuICAgICAgIGl0ZW1zLmRlc2MgPyB0YXNrSW5wdXREZXNjLnZhbHVlID0gaXRlbXMuZGVzYyA6IHRhc2tJbnB1dERlc2MudmFsdWUgPSAnJztcbiAgICAgICBpdGVtcy5kYXRlID8gdGFza0lucHV0RGF0ZS52YWx1ZSA9IGl0ZW1zLmRhdGUgOiB0YXNrSW5wdXREYXRlLnZhbHVlID0gJyc7XG4gICAgICAgXG4gICAgICAgdGFza0VkaXRNb2RhbC5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTtcbiAgICAgICBcbiAgICAgICAgY29uc3Qgc3VibWl0VGFza0VkaXQgPSAoZSkgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5sb2coc2VsZWN0ZWRUYXNrKVxuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgaXRlbXMubmFtZSA9IHRhc2tJbnB1dE5hbWUudmFsdWU7XG4gICAgICAgICAgICBpdGVtcy5kZXNjID0gdGFza0lucHV0RGVzYy52YWx1ZTtcbiAgICAgICAgICAgIGl0ZW1zLmRhdGUgPSB0YXNrSW5wdXREYXRlLnZhbHVlO1xuICAgICAgICAgICAgaXRlbXMgPSAnJztcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGl0ZW1zKTtcbiAgICAgICAgICAgIHRhc2tFZGl0TW9kYWwuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7XG4gICAgICAgICAgICB0YXNrRWRpdEZvcm0ucmVtb3ZlRXZlbnRMaXN0ZW5lcignc3VibWl0Jywgc3VibWl0VGFza0VkaXQpO1xuICAgICAgICAgICAgcmVuZGVyVGFza3MoKTtcbiAgICAgICAgICAgIHNhdmUoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGNsb3NlRWRpdFRhc2sgPSAoKSA9PiB7XG4gICAgICAgICAgICB0YXNrRWRpdEZvcm0ucmVtb3ZlRXZlbnRMaXN0ZW5lcignc3VibWl0Jywgc3VibWl0VGFza0VkaXQpO1xuICAgICAgICAgICAgdGFza0VkaXRNb2RhbC5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTtcbiAgICAgICAgICAgIGNsb3NlRWRpdFRhc2tNb2RhbC5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIGNsb3NlRWRpdFRhc2spO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgY2xvc2VFZGl0VGFza01vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmNsb3NlLXRhc2stbW9kYWwtZWRpdCcpO1xuICAgICAgICBjbG9zZUVkaXRUYXNrTW9kYWwuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBjbG9zZUVkaXRUYXNrKVxuXG4gICAgICAgdGFza0VkaXRGb3JtLmFkZEV2ZW50TGlzdGVuZXIoJ3N1Ym1pdCcsIHN1Ym1pdFRhc2tFZGl0KVxuICAgIH1cblxufVxuXG4vLyByZW5kZXJzIHRoZSB0YXNrcyBmcm9tIHRoZSBzZWxlY3RlZCBmb2xkZXIgb24gdGhlIHNjcmVlblxuY29uc3QgcmVuZGVyVGFza3MgPSAoKSA9PiB7XG4gICAgY29uc3Qgc2VsZWN0ZWRMaXN0ID0gZGlyZWN0b3J5QXJyLmZpbmQobGlzdCA9PiBsaXN0LmlkID09PSBzZWxlY3RlZEZvbGRlcik7XG5cbiAgICBpZihzZWxlY3RlZExpc3QgPT0gbnVsbCkge1xuICAgICAgICBmb2xkZXJEaXNwbGF5Q29udGFpbmVyLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgZm9sZGVyRGlzcGxheUNvbnRhaW5lci5zdHlsZS5kaXNwbGF5ID0gJyc7XG4gICAgICAgIGZvbGRlclRpdGxlLnRleHRDb250ZW50ID0gc2VsZWN0ZWRMaXN0Lm5hbWU7XG4gICAgICAgIHJlbmRlclRhc2tOdW0oc2VsZWN0ZWRMaXN0KTtcbiAgICAgICAgY2xlYXJMaXN0KHRhc2tDb250YWluZXIpO1xuICAgICAgICByZW5kZXJUYXNrTGlzdChzZWxlY3RlZExpc3QpO1xuICAgIH1cbn1cblxuLy8gY2xvc2VzIHRoZSB0YXNrIG1vZGFsIHdpdGggY2xpY2sgb2YgYnV0dG9uXG5jb25zdCBjbG9zZVRhc2tNb2RhbCA9ICgpID0+IHtcbiAgICBjb25zdCBsaXN0TW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW9kYWwtY29udGFpbmVyJylcbiAgICBsaXN0TW9kYWwuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7XG59XG5cbi8vIGZ1bmN0aW9uIHRoYXQgZGlzcGxheXMgbW9kYWwgdG8gYWRkIG5ldyB0YXNrXG5jb25zdCBjcmVhdGVUYXNrTW9kYWwgPSAoKSA9PiB7XG4gICAgY29uc3QgbGlzdE1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1vZGFsLWNvbnRhaW5lcicpXG4gICAgbGlzdE1vZGFsLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpO1xufVxuXG4vLyBmdW5jdGlvbiB0aGF0IHByb2Nlc3NlcyB0aGUgaW5wdXQgZnJvbSB0aGUgY3JlYXRlIHRhc2sgbW9kYWwgYW5kIHN1Ym1pdHMgaXQgZm9yIHN0b3JhZ2UgYW5kIGRpc3BsYXlcbmNvbnN0IHN1Ym1pdEZvcm0gPSAoZSkgPT4ge1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICBjb25zdCBsaXN0TW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW9kYWwtY29udGFpbmVyJylcbiAgICBjb25zdCB0YXNrSW5wdXROYW1lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3Rhc2snKTtcbiAgICBjb25zdCB0YXNrSW5wdXREZXNjID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2Rlc2NyaXB0aW9uJyk7XG4gICAgY29uc3QgdGFza0lucHV0RGF0ZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNkYXRlJyk7XG4gICAgY29uc3QgdGFza1Bvc3RlZCA9IGZvcm1hdEFNUE0oKTtcbiAgICBcbiAgICBjb25zdCB0YXNrTmFtZSA9IHRhc2tJbnB1dE5hbWUudmFsdWU7XG4gICAgaWYodGFza05hbWUgPT0gbnVsbCB8fCB0YXNrTmFtZSA9PT0gJycpIHJldHVybjtcbiAgICBjb25zdCB0YXNrRGVzYyA9IHRhc2tJbnB1dERlc2MudmFsdWU7XG4gICAgY29uc3QgdGFza0RhdGUgPSB0YXNrSW5wdXREYXRlLnZhbHVlXG4gICAgY29uc3QgdGFzayA9IGNyZWF0ZVRhc2sodGFza05hbWUsIHRhc2tEZXNjLCB0YXNrRGF0ZSwgdGFza1Bvc3RlZCk7XG4gICAgdGFza0lucHV0TmFtZS52YWx1ZSA9IG51bGw7XG4gICAgdGFza0lucHV0RGVzYy52YWx1ZSA9IG51bGw7XG4gICAgdGFza0lucHV0RGF0ZS52YWx1ZSA9IG51bGw7XG4gICAgY29uc3Qgc2VsZWN0ZWRMaXN0ID0gZGlyZWN0b3J5QXJyLmZpbmQobGlzdCA9PiBsaXN0LmlkID09PSBzZWxlY3RlZEZvbGRlcik7XG4gICAgc2VsZWN0ZWRMaXN0LnRhc2tzLnB1c2godGFzayk7XG4gICAgbGlzdE1vZGFsLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpO1xuICAgIHJlbmRlcigpO1xufVxuXG4vLyB0aGlzIGZ1bmN0aW9uIGNyZWF0ZXMgdGhlIHRhc2sgb2JqZWN0IHRvIGJlIHB1c2hlZCBpbnRvIHRoZSBkaXJlY3RvcnlBcnIudGFza3MgYXJyYXlcbmNvbnN0IGNyZWF0ZVRhc2sgPSAodGFzaywgZGVzYywgZGF0ZSwgcG9zdGVkKSA9PiB7XG4gICAgcmV0dXJuIHsgIGlkOiBEYXRlLm5vdygpLnRvU3RyaW5nKCksIG5hbWU6IHRhc2ssIGRlc2M6IGRlc2MsIGRhdGU6IGRhdGUsIHBvc3RlZDogcG9zdGVkLCBjb21wbGV0ZTogZmFsc2UsICB9XG59XG5cblxuZXhwb3J0IHsgcmVuZGVyVGFza3MsIGxpc3RMaXN0ZW5lcnMgfSIsImltcG9ydCB7IGNyZWF0ZUhUTUxFbGVtZW50LCByZW5kZXIgfSBmcm9tIFwiLi9pbmRleFwiO1xuaW1wb3J0IHsgcmVuZGVyVGFza3MgfSBmcm9tIFwiLi9saXN0LWNyZWF0b3JcIjtcblxuY29uc3QgTE9DQUxfU1RPUkFHRV9ESVJfS0VZID0gJ3Rhc2subGlzdCc7XG5jb25zdCBMT0NBTF9TVE9SQUdFX0ZPTERFUl9LRVkgPSAndGFzay5zZWxlY3RlZEZvbGRlcic7XG5cbi8vbG9jYWwgc3RvcmFnZSBrZXlzICsgYXJyYXlcbmxldCBzZWxlY3RlZEZvbGRlciA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKExPQ0FMX1NUT1JBR0VfRk9MREVSX0tFWSlcbmxldCBkaXJlY3RvcnlBcnIgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKExPQ0FMX1NUT1JBR0VfRElSX0tFWSkpIHx8IFtdOyBcblxuY29uc3Qgc2F2ZUFuZFJlbmRlckxpc3QgPSAoKSA9PiB7XG4gICAgc2F2ZSgpO1xuICAgIHJlbmRlckxpc3RzKCk7XG59XG5cbi8vc2F2ZXMgdG8gbG9jYWwgc3RvcmFnZVxuY29uc3Qgc2F2ZSA9ICgpID0+IHtcbiAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShMT0NBTF9TVE9SQUdFX0RJUl9LRVksIEpTT04uc3RyaW5naWZ5KGRpcmVjdG9yeUFycikpO1xuICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKExPQ0FMX1NUT1JBR0VfRk9MREVSX0tFWSwgc2VsZWN0ZWRGb2xkZXIpO1xufVxuXG4vL3JlbmRlcnMgdGhlIGRpcmVjdG9yeSBsaXN0XG5jb25zdCByZW5kZXJMaXN0cyA9ICgpID0+IHtcbiAgICBjb25zdCBkaXJlY3RvcnlDb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZGlyZWN0b3J5Jyk7XG5cbiAgICBjbGVhckxpc3QoZGlyZWN0b3J5Q29udGFpbmVyKTtcbiAgICBkaXJlY3RvcnlBcnIuZm9yRWFjaChkaXJlY3RvcnkgPT4ge1xuICAgICAgIGNvbnN0IGRpcmVjdG9yeUZvbGRlciA9IGNyZWF0ZUhUTUxFbGVtZW50KCdsaScsIG51bGwsIFsnZGlyZWN0b3J5LWZvbGRlciddLCBkaXJlY3RvcnkubmFtZSlcbiAgICAgICBkaXJlY3RvcnlGb2xkZXIuZGF0YXNldC5saXN0SWQgPSBkaXJlY3RvcnkuaWQ7XG4gICAgICAgLy9pZiB0aGUgZm9sZGVyIGlzIHNlbGVjdGVkLCBtYWtlIGl0IGFjdGl2ZSBmb2xkZXJcbiAgICAgICBpZihkaXJlY3RvcnkuaWQgPT09IHNlbGVjdGVkRm9sZGVyKSB7XG4gICAgICAgICAgIGRpcmVjdG9yeUZvbGRlci5jbGFzc0xpc3QuYWRkKCdkaXJlY3RvcnktYWN0aXZlJyk7XG4gICAgICAgfTtcbiAgICAgICBkaXJlY3RvcnlDb250YWluZXIuYXBwZW5kQ2hpbGQoZGlyZWN0b3J5Rm9sZGVyKTsgXG5cbiAgICAgICBjb25zdCBkaXJlY3RvcnlGb2xkZXJJY29ucyA9IGNyZWF0ZUhUTUxFbGVtZW50KCdzcGFuJywgbnVsbCwgWydkaXJlY3RvcnktZm9sZGVyLWljb25zJ10sIG51bGwpO1xuICAgICAgIGRpcmVjdG9yeUZvbGRlckljb25zLmlubmVySFRNTCA9ICc8YnV0dG9uIGNsYXNzPVwiYnV0dG9uLWVkaXRcIj48c3ZnIHhtbG5zPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIiBjbGFzcz1cImljb24gaWNvbi1lZGl0XCIgd2lkdGg9XCIxOFwiIGhlaWdodD1cIjE4XCIgdmlld0JveD1cIjAgMCAyNCAyNFwiIHN0cm9rZS13aWR0aD1cIjEuNVwiIHN0cm9rZT1cIiNmZmZmZmZcIiBmaWxsPVwibm9uZVwiIHN0cm9rZS1saW5lY2FwPVwicm91bmRcIiBzdHJva2UtbGluZWpvaW49XCJyb3VuZFwiPjxwYXRoIHN0cm9rZT1cIm5vbmVcIiBkPVwiTTAgMGgyNHYyNEgwelwiIGZpbGw9XCJub25lXCIvPjxwYXRoIGQ9XCJNNCAyMGg0bDEwLjUgLTEwLjVhMS41IDEuNSAwIDAgMCAtNCAtNGwtMTAuNSAxMC41djRcIiAvPjxsaW5lIHgxPVwiMTMuNVwiIHkxPVwiNi41XCIgeDI9XCIxNy41XCIgeTI9XCIxMC41XCIgLz48L3N2Zz48L2J1dHRvbj48YnV0dG9uIGNsYXNzPVwiYnV0dG9uLXRyYXNoXCI+PHN2ZyB4bWxucz1cImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCIgY2xhc3M9XCJpY29uIGljb24tdHJhc2hcIiB3aWR0aD1cIjE4XCIgaGVpZ2h0PVwiMThcIiB2aWV3Qm94PVwiMCAwIDI0IDI0XCIgc3Ryb2tlLXdpZHRoPVwiMS41XCIgc3Ryb2tlPVwiI2ZmZmZmZlwiIGZpbGw9XCJub25lXCIgc3Ryb2tlLWxpbmVjYXA9XCJyb3VuZFwiIHN0cm9rZS1saW5lam9pbj1cInJvdW5kXCI+PHBhdGggc3Ryb2tlPVwibm9uZVwiIGQ9XCJNMCAwaDI0djI0SDB6XCIgZmlsbD1cIm5vbmVcIi8+PGxpbmUgeDE9XCI0XCIgeTE9XCI3XCIgeDI9XCIyMFwiIHkyPVwiN1wiIC8+PGxpbmUgeDE9XCIxMFwiIHkxPVwiMTFcIiB4Mj1cIjEwXCIgeTI9XCIxN1wiIC8+PGxpbmUgeDE9XCIxNFwiIHkxPVwiMTFcIiB4Mj1cIjE0XCIgeTI9XCIxN1wiIC8+PHBhdGggZD1cIk01IDdsMSAxMmEyIDIgMCAwIDAgMiAyaDhhMiAyIDAgMCAwIDIgLTJsMSAtMTJcIiAvPjxwYXRoIGQ9XCJNOSA3di0zYTEgMSAwIDAgMSAxIC0xaDRhMSAxIDAgMCAxIDEgMXYzXCIgLz48L3N2Zz48L2J1dHRvbj4nO1xuICAgICAgIC8vaWYgdGhlIGZvbGRlciBpcyBzZWxlY3RlZCwgYWRkIHRoZSBpY29uc1xuICAgICAgIGlmKGRpcmVjdG9yeUZvbGRlci5jbGFzc0xpc3QuY29udGFpbnMoJ2RpcmVjdG9yeS1hY3RpdmUnKSkge1xuICAgICAgIGRpcmVjdG9yeUZvbGRlci5hcHBlbmRDaGlsZChkaXJlY3RvcnlGb2xkZXJJY29ucyk7XG4gICAgICAgfTtcbiAgICB9KVxufTtcblxuLy9jbGVhcnMgdGhlIGRpcmVjdG9yeSBsaXN0IHRvIGJlIHJlLXJlbmRlcmVkIGluIHJlbmRlckxpc3RzXG5jb25zdCBjbGVhckxpc3QgPSAobGlzdCkgPT4ge1xuICAgIHdoaWxlKGxpc3QuZmlyc3RDaGlsZCkge1xuICAgICAgICBsaXN0LnJlbW92ZUNoaWxkKGxpc3QuZmlyc3RDaGlsZClcbiAgICB9XG59O1xuXG4vL2FkZHMgZXZlbnRsaXN0ZW5lcnMgZm9yIHRoZSBkaXJlY3RvcnlcbmNvbnN0IGNyZWF0ZURpckxpc3RlbmVyID0gKCkgPT4ge1xuICAgIGNvbnN0IGRpckZvcm0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjYWRkLWRpci1mb3JtJyk7XG4gICAgY29uc3QgZGlyQ29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmRpcmVjdG9yeScpO1xuXG4gICAgZGlyRm9ybS5hZGRFdmVudExpc3RlbmVyKCdzdWJtaXQnLCBjcmVhdGVEaXJlY3RvcnkpXG4gICAgZGlyQ29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgc2VsZWN0ZWREaXJlY3RvcnlMaXN0ZW5lcilcbiAgICBkaXJDb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBkZWxldGVEaXIpXG4gICAgZGlyQ29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZWRpdERpcilcbn1cblxuLy9jcmVhdGVzIGEgbmV3IGRpcmVjdG9yeSBmb2xkZXJcbmNvbnN0IGNyZWF0ZURpcmVjdG9yeSA9IChlKSA9PiB7XG4gICAgY29uc3QgZGlyVGV4dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5hZGQtZGlyLWJ0bi10ZXh0Jyk7XG5cbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgY29uc3QgZGlyTmFtZSA9IGRpclRleHQudmFsdWU7XG4gICAgaWYoZGlyTmFtZSA9PSBudWxsIHx8IGRpck5hbWUgPT09ICcnKSByZXR1cm47XG4gICAgY29uc3QgZGlyZWN0b3J5ID0gY3JlYXRlTmV3RGlyKGRpck5hbWUpO1xuICAgIGRpclRleHQudmFsdWUgPSBudWxsO1xuICAgIGRpcmVjdG9yeUFyci5wdXNoKGRpcmVjdG9yeSk7XG4gICAgc2F2ZUFuZFJlbmRlckxpc3QoKTtcbn1cblxuLy9mdW5jdGlvbiBmb3IgdGhlIHNlbGVjdGVkIGRpcmVjdG9yeSBsaXN0ZW5lclxuY29uc3Qgc2VsZWN0ZWREaXJlY3RvcnlMaXN0ZW5lciA9IChlKSA9PiB7XG4gICAgaWYoZS50YXJnZXQudGFnTmFtZS50b0xvd2VyQ2FzZSgpID09PSAnbGknKSB7XG4gICAgICAgIHNlbGVjdGVkRm9sZGVyID0gZS50YXJnZXQuZGF0YXNldC5saXN0SWQ7XG4gICAgICAgIHNhdmVBbmRSZW5kZXJMaXN0KCk7XG4gICAgICAgIHJlbmRlclRhc2tzKCk7XG4gICAgfVxufVxuXG4vL2Z1bmN0aW9uIGZvciB0aGUgZGVsZXRlZGlyIGxpc3RlbmVyIFxuY29uc3QgZGVsZXRlRGlyID0gKGUpID0+IHtcbiAgICBpZihlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2ljb24tdHJhc2gnKSB8fCBlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2J1dHRvbi10cmFzaCcpKSB7XG4gICAgICAgIGlmKGUudGFyZ2V0LnBhcmVudEVsZW1lbnQucGFyZW50RWxlbWVudC5wYXJlbnRFbGVtZW50LmRhdGFzZXQubGlzdElkID09PSBzZWxlY3RlZEZvbGRlciB8fCBlLnRhcmdldC5wYXJlbnRFbGVtZW50LnBhcmVudEVsZW1lbnQuZGF0YXNldC5saXN0SWQgPT09IHNlbGVjdGVkRm9sZGVyKSB7XG4gICAgICAgIGRpcmVjdG9yeUFyciA9IGRpcmVjdG9yeUFyci5maWx0ZXIoZGlyZWN0b3J5ID0+IGRpcmVjdG9yeS5pZCAhPT0gc2VsZWN0ZWRGb2xkZXIpO1xuICAgICAgICBzZWxlY3RlZEZvbGRlciA9IG51bGw7XG4gICAgICAgIHJlbmRlcigpO1xuICAgICAgICB9XG4gICAgfVxufVxuLy9FZGl0aW5nIHRoZSBkaXJlY3RvcnkgZm9sZGVyIHRpdGxlIGFuZCB1cGRhdGluZyB0aGUgYXJyYXkgKyBET01cbmNvbnN0IGVkaXREaXIgPSAoZSkgPT4ge1xuICAgIGlmKGUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnaWNvbi1lZGl0JykgfHwgZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdidXR0b24tZWRpdCcpKSB7XG4gICAgICAgIGlmKGUudGFyZ2V0LnBhcmVudEVsZW1lbnQucGFyZW50RWxlbWVudC5wYXJlbnRFbGVtZW50LmRhdGFzZXQubGlzdElkID09PSBzZWxlY3RlZEZvbGRlciB8fCBlLnRhcmdldC5wYXJlbnRFbGVtZW50LnBhcmVudEVsZW1lbnQuZGF0YXNldC5saXN0SWQgPT09IHNlbGVjdGVkRm9sZGVyKSB7XG4gICAgICAgIGNvbnN0IGRpcmVjdG9yeU1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmRpcmVjdG9yeS1tb2RhbC1jb250YWluZXInKTtcbiAgICAgICAgZGlyZWN0b3J5TW9kYWwuY2xhc3NMaXN0LnRvZ2dsZSgnYWN0aXZlJyk7XG4gICAgICAgIGNvbnN0IGVkaXREaXJCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjZGlyZWN0b3J5LWVkaXQtZm9ybScpO1xuICAgICAgICBjb25zdCBjbG9zZUVkaXREaXJCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuaWNvbi10YWJsZXItc3F1YXJlLXgnKTtcblxuICAgICAgICBjb25zdCBlZGl0RGlyRm9ybSA9IChlKSA9PiB7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICBjb25zdCBkaXJlY3RvcnlNb2RhbFRleHQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjdGV4dC1kaXInKTtcbiAgICAgICAgICAgIGNvbnN0IGRpcmVjdG9yeVJlTmFtZSA9IGRpcmVjdG9yeU1vZGFsVGV4dC52YWx1ZTtcbiAgICAgICAgICAgIGlmKGRpcmVjdG9yeVJlTmFtZSA9PSBudWxsIHx8IGRpcmVjdG9yeVJlTmFtZSA9PT0gJycpIHJldHVybjtcbiAgICAgICAgICAgIGRpcmVjdG9yeUFyci5mb3JFYWNoKGRpciA9PiB7XG4gICAgICAgICAgICAgICAgaWYoZGlyLmlkID09PSBzZWxlY3RlZEZvbGRlcikge1xuICAgICAgICAgICAgICAgICAgICBkaXIubmFtZSA9IGRpcmVjdG9yeVJlTmFtZVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICBkaXJlY3RvcnlNb2RhbFRleHQudmFsdWUgPSBudWxsO1xuICAgICAgICAgICAgc2F2ZUFuZFJlbmRlckxpc3QoKTtcbiAgICAgICAgICAgIHJlbmRlclRhc2tzKCk7XG4gICAgICAgICAgICBkaXJlY3RvcnlNb2RhbC5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTtcbiAgICAgICAgICAgIGVkaXREaXJCdG4ucmVtb3ZlRXZlbnRMaXN0ZW5lcignc3VibWl0JywgZWRpdERpckZvcm0pO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgY2xvc2VFZGl0RGlyID0gKCkgPT4ge1xuICAgICAgICAgICAgZGlyZWN0b3J5TW9kYWwuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7XG4gICAgICAgICAgICBlZGl0RGlyQnRuLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3N1Ym1pdCcsIGVkaXREaXJGb3JtKTtcbiAgICAgICAgICAgIGNsb3NlRWRpdERpckJ0bi5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIGNsb3NlRWRpdERpcik7XG4gICAgICAgIH1cblxuICAgICAgICBjbG9zZUVkaXREaXJCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBjbG9zZUVkaXREaXIpO1xuICAgICAgICBlZGl0RGlyQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ3N1Ym1pdCcsIGVkaXREaXJGb3JtKTtcbiAgICB9XG4gICAgfVxuICAgIFxuXG59XG5cbi8vY3JlYXRlcyBhIGRpcmVjdG9yeSBmb2xkZXIgb2JqZWN0IHRvIGJlIHB1c2hlZCBpbnRvIGRpcmVjdG9yeSBhcnJheVxuY29uc3QgY3JlYXRlTmV3RGlyID0gKGRpcikgPT4ge1xuICAgcmV0dXJuIHsgaWQ6IERhdGUubm93KCkudG9TdHJpbmcoKSwgbmFtZTogZGlyLCB0YXNrczogW10gfVxufVxuXG5leHBvcnQgeyByZW5kZXJMaXN0cywgY3JlYXRlRGlyTGlzdGVuZXIsIHNhdmVBbmRSZW5kZXJMaXN0LCBkaXJlY3RvcnlBcnIsIHNlbGVjdGVkRm9sZGVyLCBjbGVhckxpc3QsIHNhdmUgfSIsImltcG9ydCB7IGNyZWF0ZURpckxpc3RlbmVyLCBzYXZlQW5kUmVuZGVyTGlzdCwgcmVuZGVyTGlzdHMsIGRpcmVjdG9yeUFyciwgc2VsZWN0ZWRGb2xkZXIgfSBmcm9tIFwiLi9kaXJlY3RvcnktY3JlYXRvclwiO1xuaW1wb3J0IHsgdG9nZ2xlVGhlbWUgfSBmcm9tIFwiLi90b2dnbGVUaGVtZVwiO1xuaW1wb3J0IHsgcmVuZGVyVGFza3MsIGxpc3RMaXN0ZW5lcnMgfSBmcm9tIFwiLi9saXN0LWNyZWF0b3JcIlxuaW1wb3J0IHsgZGlzcGxheURhdGUgfSBmcm9tIFwiLi9kYXRlXCI7XG5cbmZ1bmN0aW9uIGNyZWF0ZUhUTUxFbGVtZW50KHR5cGUsIGlkLCBjbGFzc2VzLCBjb250ZW50KSB7XG4gICAgY29uc3QgZWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQodHlwZSk7XG5cbiAgICBpZihpZCkgZWxlbWVudC5pZCA9IGlkO1xuICAgIGlmKGNsYXNzZXMpIHtcbiAgICAgICAgY2xhc3Nlcy5mb3JFYWNoKChteUNsYXNzKSA9PiBlbGVtZW50LmNsYXNzTGlzdC5hZGQobXlDbGFzcykpO1xuICAgIH07XG4gICAgaWYoY29udGVudCkgZWxlbWVudC50ZXh0Q29udGVudCA9IGNvbnRlbnQ7XG5cbiAgICByZXR1cm4gZWxlbWVudDtcbn07XG5cbmNvbnN0IHJlbmRlciA9ICgpID0+IHtcbiAgICBzYXZlQW5kUmVuZGVyTGlzdCgpO1xuICAgIHJlbmRlclRhc2tzKCk7XG59XG5cbmNvbnN0IG9uTG9hZCA9ICgpID0+IHtcbiAgICB0b2dnbGVUaGVtZSgpO1xuICAgIHJlbmRlcigpO1xuICAgIGNyZWF0ZURpckxpc3RlbmVyKCk7XG4gICAgbGlzdExpc3RlbmVycygpOyBcbiAgICBkaXNwbGF5RGF0ZSgpO1xuICAgIHRpbWU7XG59XG5cbmNvbnN0IHRpbWUgPSBzZXRJbnRlcnZhbChkaXNwbGF5RGF0ZSwgMTAwMCk7XG5cbm9uTG9hZCgpO1xuXG5leHBvcnQge1xuICAgIGNyZWF0ZUhUTUxFbGVtZW50LCByZW5kZXJcbn0iLCJjb25zdCB0b2dnbGVUaGVtZSA9ICgpID0+IHtcblxuY29uc3QgdG9nZ2xlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmxpZ2h0LWRhcmstbW9kZScpO1xudG9nZ2xlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdG9nZ2xlTW9kZSk7XG5cbmxldCBkYXJrTW9kZSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdkYXJrTW9kZScpO1xuY29uc3QgY3VycmVudFRoZW1lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmN1cnJlbnQtdGhlbWUnKTtcblxuaWYoZGFya01vZGUgPT09ICdlbmFibGVkJykge1xuICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdkYXJrTW9kZScsICdlbmFibGVkJylcbiAgICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpO1xuICAgIHRvZ2dsZS5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTtcbiAgICBjdXJyZW50VGhlbWUudGV4dENvbnRlbnQgPSAnRGFyayBNb2RlJ1xufVxuXG5mdW5jdGlvbiB0b2dnbGVNb2RlKCkge1xuICAgIGRhcmtNb2RlID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2RhcmtNb2RlJylcbiAgICBpZihkYXJrTW9kZSAhPT0gJ2VuYWJsZWQnKSB7XG4gICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdkYXJrTW9kZScsICdlbmFibGVkJylcbiAgICAgICAgZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTtcbiAgICAgICAgdG9nZ2xlLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdkYXJrTW9kZScsIG51bGwpXG4gICAgICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7XG4gICAgICAgIHRvZ2dsZS5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTtcbiAgICB9XG5cbiAgICBpZih0b2dnbGUuY2xhc3NMaXN0LmNvbnRhaW5zKCdhY3RpdmUnKSkgeyBcbiAgICAgICAgY3VycmVudFRoZW1lLnRleHRDb250ZW50ID0gJ0RhcmsgTW9kZSc7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgY3VycmVudFRoZW1lLnRleHRDb250ZW50ID0gJ0xpZ2h0IE1vZGUnO1xuICAgIH07XG59XG59XG5cbmV4cG9ydCB7IHRvZ2dsZVRoZW1lIH0iXSwibmFtZXMiOlsiX193ZWJwYWNrX3JlcXVpcmVfXyIsImV4cG9ydHMiLCJkZWZpbml0aW9uIiwia2V5IiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsIm9iaiIsInByb3AiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiLCJkaXNwbGF5RGF0ZSIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsInRleHRDb250ZW50IiwiZm9ybWF0QU1QTSIsImQiLCJEYXRlIiwibWludXRlcyIsImdldE1pbnV0ZXMiLCJ0b1N0cmluZyIsImxlbmd0aCIsImhvdXJzIiwiZ2V0SG91cnMiLCJhbXBtIiwiZ2V0RGF5IiwiZ2V0TW9udGgiLCJnZXREYXRlIiwiZ2V0RnVsbFllYXIiLCJmb2xkZXJEaXNwbGF5Q29udGFpbmVyIiwiZm9sZGVyVGl0bGUiLCJ0YXNrQ291bnQiLCJ0YXNrQ29udGFpbmVyIiwidGFza1RlbXBsYXRlIiwicmVuZGVyVGFza051bSIsInNlbGVjdGVkVGFza051bSIsImluY29tcGxldGUiLCJ0YXNrcyIsImZpbHRlciIsInRhc2siLCJjb21wbGV0ZSIsInRhc2tzU3RyaW5nIiwicmVuZGVyVGFza3MiLCJzZWxlY3RlZExpc3QiLCJkaXJlY3RvcnlBcnIiLCJmaW5kIiwibGlzdCIsImlkIiwic2VsZWN0ZWRGb2xkZXIiLCJzdHlsZSIsImRpc3BsYXkiLCJuYW1lIiwiY2xlYXJMaXN0IiwiZm9yRWFjaCIsInRhc2tET00iLCJpbXBvcnROb2RlIiwiY29udGVudCIsImNoZWNrQm94IiwiY2hlY2tlZCIsInRhc2tEZXNjIiwiZGVzYyIsInRhc2tEYXRlIiwiZGF0ZSIsInBvc3RlZCIsImlubmVySFRNTCIsImFwcGVuZENoaWxkIiwiY3JlYXRlVGFzayIsIm5vdyIsIkxPQ0FMX1NUT1JBR0VfRElSX0tFWSIsIkxPQ0FMX1NUT1JBR0VfRk9MREVSX0tFWSIsImxvY2FsU3RvcmFnZSIsImdldEl0ZW0iLCJKU09OIiwicGFyc2UiLCJzYXZlQW5kUmVuZGVyTGlzdCIsInNhdmUiLCJyZW5kZXJMaXN0cyIsInNldEl0ZW0iLCJzdHJpbmdpZnkiLCJkaXJlY3RvcnlDb250YWluZXIiLCJkaXJlY3RvcnkiLCJkaXJlY3RvcnlGb2xkZXIiLCJjcmVhdGVIVE1MRWxlbWVudCIsImRhdGFzZXQiLCJsaXN0SWQiLCJjbGFzc0xpc3QiLCJhZGQiLCJkaXJlY3RvcnlGb2xkZXJJY29ucyIsImNvbnRhaW5zIiwiZmlyc3RDaGlsZCIsInJlbW92ZUNoaWxkIiwiY3JlYXRlRGlyZWN0b3J5IiwiZSIsImRpclRleHQiLCJwcmV2ZW50RGVmYXVsdCIsImRpck5hbWUiLCJ2YWx1ZSIsImNyZWF0ZU5ld0RpciIsInB1c2giLCJzZWxlY3RlZERpcmVjdG9yeUxpc3RlbmVyIiwidGFyZ2V0IiwidGFnTmFtZSIsInRvTG93ZXJDYXNlIiwiZGVsZXRlRGlyIiwicGFyZW50RWxlbWVudCIsInJlbmRlciIsImVkaXREaXIiLCJkaXJlY3RvcnlNb2RhbCIsInRvZ2dsZSIsImVkaXREaXJCdG4iLCJjbG9zZUVkaXREaXJCdG4iLCJlZGl0RGlyRm9ybSIsImRpcmVjdG9yeU1vZGFsVGV4dCIsImRpcmVjdG9yeVJlTmFtZSIsImRpciIsInJlbW92ZSIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJjbG9zZUVkaXREaXIiLCJhZGRFdmVudExpc3RlbmVyIiwidHlwZSIsImNsYXNzZXMiLCJlbGVtZW50IiwiY3JlYXRlRWxlbWVudCIsIm15Q2xhc3MiLCJzZXRJbnRlcnZhbCIsImRhcmtNb2RlIiwiYm9keSIsImN1cnJlbnRUaGVtZSIsInRvZ2dsZVRoZW1lIiwiZGlyRm9ybSIsImRpckNvbnRhaW5lciIsImNyZWF0ZURpckxpc3RlbmVyIiwibGlzdE1vZGFsIiwidGFza0lucHV0TmFtZSIsInRhc2tJbnB1dERlc2MiLCJ0YXNrSW5wdXREYXRlIiwidGFza1Bvc3RlZCIsInRhc2tOYW1lIiwic2VsZWN0ZWRFbGVtZW50IiwicGFyZW50Tm9kZSIsInNlbGVjdGVkVGFzayIsIkFycmF5IiwiZnJvbSIsImNoaWxkcmVuIiwiaW5kZXhPZiIsIml0ZW1zIiwidGFza0VkaXRNb2RhbCIsInRhc2tFZGl0Rm9ybSIsInN1Ym1pdFRhc2tFZGl0IiwiY29uc29sZSIsImxvZyIsImNsb3NlRWRpdFRhc2siLCJjbG9zZUVkaXRUYXNrTW9kYWwiXSwic291cmNlUm9vdCI6IiJ9